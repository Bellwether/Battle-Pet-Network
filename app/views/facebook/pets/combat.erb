<% content_for :page_title do %><h2>Your Combat Profile</h2><% end %>
	
<div class="sidebox slim right">
  <div class="box slim">	
    <h4>Favorite Actions</h4>
    <p class="em">Every breed and every pet has a favorite action that characterizes their combat style. Using these actions in 
	battle will confer bonus experience for 'fighting in style'. Greedily relying only on these actions, however, will make 
	your pet predictable.</p>
	<table>
	  <tbody>
		<tr>
		  <td><label>Favorite <%= @pet.breed.name %> Action:</label></td>
		  <td><%= @pet.breed.favorite_action.name %></td>
		</tr>
		<tr>
		  <td>Pet's Favorite Action:</td>
		  <td>
		  <% if @pet.favorite_action_id.blank? %>
		    <% form_for @pet, :url => facebook_nested_url(facebook_pet_path(@pet)), :html => { :method => :put} do |f| %>
			  <%= f.collection_select(:favorite_action_id, @pet.actions, :id, :name, {:include_blank => true}) %>
			  <%= f.submit 'Save' %> 
			<% end %>
		  <% else %>
		    <%= @pet.favorite_action.name %>
		  <% end %>
		  </td>
		</tr>
	  </tbody>	
	</table>
  </div>

  <div class="box slim">	
    <h4>Strategies</h4>
    <p class="em">
	  <% if @strategies.blank? %>
	  You haven't saved any strategies yet. When you issue or respond to a challenge and select a strategy, you'll have the 
	  option to save it for quick access before battle. 
	  <% else %>
	  You've saved the following strategies for quick access before battle. 
	  <% end %>
	</p>
	<% unless @strategies.blank? %>
	  <table class="strategies">
		<% @strategies.each do |strategy| %>
		  <tr>
			<td></td>
			<td><%= strategy.name %></td>
			<td><%= strategy.average_power %></td>
			<td>
			</td>
		  </tr>
		<% end %>
	  </table>	
	<% end %>
  <div>
	
  <div class="box slim">	
    <h4>Battle History</h4>
  <div>
</div>

<div class="box">
  <table id="combat-profile">
	<tr>
	  <td>
	    <h3><%= @pet.name %></h3>
		<table>
		  <tr>
		    <td rowspan="4"><%= avatar_image(@pet,'medium') %></td>
		    <td><label>Endurance: <%= @pet.endurance %></label></td>
		  </tr>
		  <tr><td><label>Health: <%= @pet.health %></label></td></tr>
		  <tr><td><label>Power: <%= @pet.power %></label></td></tr>
		  <tr><td><label>Fortitude: <%= @pet.fortitude %></label></td></tr>
		  <tr>
			<td><h5><%= @pet.breed.name %></h5></td>
		    <td><label>Intelligence: <%= @pet.intelligence %></label></td>
		  </tr>
		</table>
	  </td>
	</tr>
	<tr>
	  <td>
		<table>
		  <tr><td><label class="strong">Total Battles:</label></td><td><%= @pet.battles_count %></td></tr>
		  <tr><td><label>Wins:</label></td><td><%= @pet.wins_count %><%= graph_bar [@pet.wins_count,@pet.battles_count]%></td></tr>
		  <tr><td><label>Loses:</label></td><td><%= @pet.loses_count %><%= graph_bar [@pet.loses_count,@pet.battles_count]%></td></tr>
		  <tr><td><label>Draws:</label></td><td><%= @pet.draws_count %><%= graph_bar [@pet.draws_count,@pet.battles_count]%></td></tr>
		</table>
	  </td>	
	</tr>
	<tr>
	  <td>
		<h5>Leaderboard Ranking</h5>
		<p>
		  Current: 999<br />
		  <span class="em">No ranking bonus</span>
		</p>
		<p>1 Week Ago: 999</p>
		<p>2 Weeks Ago: 999</p>
	  </td>
	</tr>
  </table>
</div>

<% unless @pet.belongings.battle_ready.blank? %>
<div class="box gear">
  <h4>Battle Gear</h4>

  <% cell_table(@pet.belongings.battle_ready,4) do |b,idx| %>
    <td class='battle-gear'>
	  <div class='i.item-#{b.item.slug.downcase.gsub(/\s/,'-')}-small left'></div>
	  <label class="strong"><%= b.item.name %></label> 
	  <br />
	  <label class="em">Power: <%= b.item.power %></label>
    </td>
  <% end %>
</div>
<% end %>

<div class="box">
  <table>	
	<tr>
	  <td>
	    <h4>Advancement</h4>
	    <h5>Level <%=@pet.level_rank_count %></h5>
	  </td>
	  <td>
		<label>Current Experience:</label> <label class="strong"><% @pet.experience %></label>
		<br />
		<% if next_level = @pet.level.next_level %>
		  <label>Current Experience:</label> <label class="strong"><% next_level.experience %></label>
		<% end %>
	  </td>
	  <td>
		<%= experience_bar @pet.level %>
	  </td>
	</tr>
  </table>
  <table id="advancements">
	<tr><th>Level</th><th>Experience</th><th>Advancement</th><th>Obtained</th></tr>
	<% @pet.breed.levels.each_with_index do |l,idx| %>
	  <tr class="<%= @pet.level_rank_count >= idx ? 'complete' : 'incomplete'%>">
		<td><%= l.rank %></td>
		<td><%= l.experience %></td>
		<td><%= "+#{l.advancement_amount} #{l.advancement_type}"%></td>
		<td><%= @pet.level_rank_count >= idx ? 'YES' : 'NO'%></td>
	  </tr>
	<% end %>
  </table>
</div>