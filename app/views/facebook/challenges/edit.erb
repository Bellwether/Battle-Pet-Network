<% content_for :page_title do %><h2>Respond to Challenge</h2><% end %>

<div class="box full">

<table class="comparison-table">
<tbody>
  <tr>
	<th class="leftbox"><%= @challenge.attacker.name %></th>
	<td>challenged</td>
	<th class="rightbox"><%= @challenge.defender.name %></th>
  </tr>
</tbody>
</table>

<% form_for @challenge, :url => facebook_nested_url(new_facebook_pet_challenge_path(@pet)), :html => { :method => :post} do |f| %>	
<table class="comparison-table">
  <tbody>
	<tr>
	<td class="leftbox">
	  <table class="dotbox">
		<tr>
		  <td rowspan="5"><div class="<%="avatar-#{@challenge.attacker.slug}-large" %> left"></div></td>
		  <td>&nbsp;</td>
		  <td><%= @challenge.attacker.breed.name %></td>
		</tr>
		<%= details_bar_row(@challenge.attacker.health,@challenge.defender.health) %>
		<%= details_bar_row(@challenge.attacker.endurance,@challenge.defender.endurance) %>
		<%= details_bar_row(@challenge.attacker.power,@challenge.defender.power) %>
		<%= details_bar_row(@challenge.attacker.fortitude,@challenge.defender.fortitude) %>
		<%= details_bar_row(@challenge.attacker.intelligence,@challenge.defender.intelligence) %>
		<tr>
		  <td rowspan="3">
			<% cell_table(@challenge.attacker.belongings.battle_ready) do |b,idx| %>
			  <td class='battle-gear'>
				<div class='i.item-#{b.item.slug.downcase.gsub(/\s/,'-')}-small left'></div>
				<label><%= b.item.name %></label> <label class="em"><%= b.item.power %></label>
			  </td>
			<% end %>
		  </td>
		  <td><%= percentage_bar [@challenge.attacker.level_rank_count,@challenge.defender.level_rank_count] %></td>
		  <td><%= @challenge.attacker.level_rank_count %></td>
		</tr>
		<tr>
		  <td>&nbsp;</td>
		  <td>
			<% cell_table(@challenge.defender.belongings.battle_ready) do |b,idx| %>
			  <td class='battle-gear'>
				<div class='i.item-#{b.item.slug.downcase.gsub(/\s/,'-')}-small left'></div>
				<label><%= b.item.name %></label> <label class="em"><%= b.item.power %></label>
			  </td>
			<% end %>
		  </td>
		</tr>
		<tr>
		  <td colspan="3">
			<div>Attacker's Strategy'</div>
			<p class="em">
			  The attacker has already chosen their strategy. It's up to you now to outwit them with a better strategy 
			  of your own...
			</p>
		  </td>
		</tr>
	  </table>
	</td>
	<tr>	
	<td class="middlebox">
	  <table class="dotbox">
		<tr><td>Breed</td></tr>
		<tr><td>Health</td></tr>
		<tr><td>Endurance</td></tr>
		<tr><td>Power</td></tr>
		<tr><td>Fortitude</td></tr>
		<tr><td>Intelligence</td></tr>
		<tr><td>Level</td></tr>
		<tr><td>Favorite Action</td></tr>
		<tr><td>&nbsp;</td><tr>
		<tr><th>Combat</th></tr>
		<tr><td><%= submit_tag "Challenge"%></td></tr>
	</td>	
	</tr>	
	<tr>
	<td class="rightbox">
	  <table class="dotbox">
		<tr>
		  <td><%= @challenge.defender.health %></td>
		  <td>&nbsp;</td>
		  <td rowspan="5"><div class="<%="avatar-#{@challenge.defender.slug}-large" %> right"></div></td>
		</tr>
		<%= details_bar_row(@challenge.defender.health,@challenge.attacker.health, 'right') %>
		<%= details_bar_row(@challenge.defender.endurance,@challenge.attacker.endurance, 'right') %>
		<%= details_bar_row(@challenge.defender.power,@challenge.attacker.power, 'right') %>
		<%= details_bar_row(@challenge.defender.fortitude,@challenge.attacker.fortitude, 'right') %>
		<%= details_bar_row(@challenge.defender.intelligence,@challenge.attacker.intelligence, 'right') %>
		<tr>
		  <td rowspan="3">
			<% cell_table(@challenge.defender.belongings.battle_ready) do |b,idx| %>
			  <td class='battle-gear'>
				<div class='i.item-#{b.item.slug.downcase.gsub(/\s/,'-')}-small left'></div>
				<label><%= b.item.name %></label>
			  </td>
			<% end %>
		  </td>
		  <td><%= percentage_bar [@challenge.defender.level_rank_count,@challenge.attacker.level_rank_count] %></td>
		  <td><%= @challenge.defender.level_rank_count %></td>
		</tr>
		<tr>
		  <td></td>
		  <td>&nbsp;</td>
		</tr>
		<tr>
		  <td colspan="3">
			<div>Your Pet's Battle Strategy</div>
			<%= render_strategy_picker(f,'defender_strategy') %>
		  </td>
		</tr>
	  </table>
	</td> 	
	</tr>
  </tbody>
</table>
<% end %>